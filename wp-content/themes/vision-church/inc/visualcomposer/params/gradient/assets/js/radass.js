(function(e){function t(a){0>a&&(a+=360);return a%360}function B(a,c,e){var f=a.pageX;a=a.pageY;var w=48+b.pos.left,k=48+b.pos.top,d=Math.sqrt(Math.pow(f-w,2)+Math.pow(a-k,2)),h=t(b.angle);315<h||45>h||135<h&&225>h?(d*=Math.cos(z*h),f<w&&(d=-d)):(d*=Math.sin(z*h),a<k&&(d=-d));c=Math.max(Math.min(d+72-4,e),c);return parseInt(c,10)}var n=function(){var a=window.getComputedStyle(document.documentElement,""),a=(Array.prototype.slice.call(a).join("").match(/-(moz|webkit|ms)-/)||""===a.OLink&&["","o"])[1];return{dom:"WebKit|Moz|MS|O".match(new RegExp("("+a+")","i"))[1],lowercase:a,css:"-"+a+"-",js:a[0].toUpperCase()+a.substr(1)}}(),q=e("<div/>").css({position:"relative",margin:"0 auto",display:"inline-block"}),f=e("<div/>").css({borderRadius:"50%",overflow:"hidden",background:"white"}).width(96).height(96).appendTo(q);f.css({zIndex:1});var y=parseInt(16/3,10),D=(96-y)/2,k=e("<div/>").css({position:"absolute",left:-24,top:D,background:"purple",borderWidth:"1px",borderStyle:"solid",borderColor:"black"}).width(144).height(y).appendTo(q),r=e("<div/>").css({position:"absolute",left:"45%",top:"-50px",borderRadius:"50%",background:"purple",cursor:"move"}).width(8).height(8).hide().appendTo(q),y=e("<div/>").css({position:"absolute",left:-20,top:0,backgroundImage:"url(data:image/gif;base64,R0lGODlhEAAQAKEBAICAgP///////////yH5BAEKAAIALAAAAAAQABAAAAIylC+gyAfejJp0uYCzDk/W30mbFooAdnIcc6buirToXCbq3bI4rb9qLdsBR5laAmSMNAoAOw==)",cursor:"pointer"}).width(16).height(16).on("click",function(a){u.trigger("del");a.stopPropagation()}),d=e("<div/>").css({position:"absolute",left:0,top:0,backgroundImage:"url(data:image/gif;base64,R0lGODdhEAAQAIQaAOnp6UJCQubm5kdHRyYmJjY2NkVFRT09PUZGRkpKSj4+PklJSfHx8d7e3vj4+PX19eLi4tbW1u3t7dra2vv7+9PT0/39/dDQ0EFBQTMzM////////////////////////ywAAAAAEAAQAAAFYGAmjmQpWmiqqiLlvjAsOnRdFHUtPny/JL2eiEEsDgbFokjCbAYCzaYIAMBYr1iqSCDAejFcEWRMfpLJooZ6bUCs16KJfK44zOeiiH5PIOz3IhWCg4SEIheIiYqKJo0kIQA7)"}).width(16).height(16).hide().on("click",function(a){k.trigger("add");a.stopPropagation()}),C=0,u=!1,v=!1,A=e("<input/>",{type:"hidden",value:"#ff00ff"}).css({position:"absolute",bottom:0,left:0}).appendTo(q);A.minicolors({inline:!0,opacity:!0,change:function(a,b){!1!==u&&u.trigger("setColor",[a,b])}});var x=A.next(".minicolors-panel").css({position:"absolute",zIndex:9999}).append(y).hide(),b={lastbg:"dumb solid color"},E={transition:n.css+"transform 0.5s ease-in-out",transform:"scale(2) rotate(45deg)",opacity:1},F={transition:n.css+"transform 0.5s ease-in-out",transform:"scale(1) rotate(0deg)",opacity:.7},z=Math.PI/180,G=180/Math.PI;k.on("click",function(a){if(!(!1!==u||500>Date.now()-C)){a=B(a,-(b.pointPad+1),144-(b.pointPad+1));a-=parseInt((d.width()-1)/2,10);var c=-parseInt((d.height()-k.height()-1)/2,10);v?d.animate({left:a}):(v=!0,d.css({left:a,top:c,zIndex:b.color.length}).show(200))}}).on("refresh",function(){k.trigger("set",[b.color])}).on("add",function(a){a=100/(144-(b.pointPad+1)- -(b.pointPad+1));a=d.css("left").slice(0,-2)*a+(d.width()-1)/2;a=parseInt(a,10);b.color.push("#ff00ff "+a+"%");d.hide(200);v=!1;k.trigger("set",[b.color]);f.trigger("refresh")}).on("set",function(a,c){d.detach();k.empty();d.appendTo(k);b.points=[];var w=144-(b.pointPad+1),n=-(b.pointPad+1),q=100/(w-n);e.each(c,function(a,c){var h,l;if("#"===this.charAt(0)){l=1;var m=this.split(" ");h=m[0];m=m[1];m=parseInt(m.toString().slice(0,-1),10)}else{m=this.split(") ");l=m[0];m=m[1];m=parseInt(m.toString().slice(0,-1),10);l="("===l.charAt(3)?l.slice(4).split(","):l.slice(5).split(",");h=parseInt(e.trim(l[0]),10).toString(16);2>h.length&&(h="0"+h);var r=parseInt(e.trim(l[1]),10).toString(16);2>r.length&&(r="0"+r);var t=parseInt(e.trim(l[2]),10).toString(16);2>t.length&&(t="0"+t);l=void 0===l[3]?1:parseFloat(e.trim(l[3]),10);h="#"+h+r+t}var g={color:h,pos:m,$:0,css:this,opacity:l},p=e("<div/>").css({position:"absolute",left:Math.max(Math.min(parseInt(m/q,10)-(b.pointPad+1),w),n),top:-3,width:2*b.pointPad+1,height:2*b.pointPad+1,background:g.color,opacity:.7,border:"1px solid black"}).on("getColor",function(){if(1==g.opacity)return g.color;var a=g.color.slice(1),b=parseInt(a.substring(0,2),16),c=parseInt(a.substring(2,4),16),a=parseInt(a.substring(4,6),16);return"rgba("+b+","+c+","+a+","+parseFloat(g.opacity,10)+")"}).on("getCss",function(){return p.triggerHandler("getColor")+" "+g.pos+"%"}).on("getPos",function(){var a=parseInt(p.css("left").slice(0,-2))+b.pointPad+1;return Math.max(Math.min(parseInt(a*q,10),100),0)}).on("setColor",function(a,b,c){g.color=b;g.opacity=void 0===c?1:c;a=p.triggerHandler("getColor");g.css=a+" "+g.pos+"%";p.css("background",a);f.trigger("sort");f.trigger("refresh")}).drag("start",function(a,b){}).drag(function(a,b){var c=B(a,n,w);v&&(d.hide(200),v=!1);p.css({left:c});c=p.triggerHandler("getPos");g.pos=c;g.css=p.triggerHandler("getCss");C=Date.now();f.trigger("sort").trigger("refresh")}).on("click",function(a){p.css(E);u=p;x.show();A.attr("data-opacity",g.opacity).minicolors("value",[g.color]);a.stopPropagation()}).on("del",function(){if(!(3>b.points.length)){var a=b.points.indexOf(g);-1!==a&&(b.points[a].$.remove(),u=!1,b.points.splice(a,1),x.hide(),f.trigger("sort"),f.trigger("refresh"))}}).appendTo(k);g.$=p;g.css=p.triggerHandler("getCss");b.points.push(g)});f.trigger("sort")});r.on("set",function(a,c,d){b.angle=t(c);c=(180-c)*z;r.css({top:48+48*Math.cos(c)-4,left:48+48*Math.sin(c)-4});!0===d&&f.trigger("refresh")});r.drag("start",function(a,c){b.pos=f.offset()}).drag(function(a,c){angle=Math.atan2(a.pageX-(48+b.pos.left),a.pageY-(48+b.pos.top));var d=180-t(parseInt(G*angle,10));r.trigger("set",[d,!0])});f.on("sort",function(){b.points.sort(function(a,b){return a.pos<b.pos?-1:a.pos>b.pos?1:0});b.color=[];e.each(b.points,function(a,c){b.color.push(this.css);this.$.css("z-index",a)})}).on("css",function(){var a=t(360-b.angle);switch(b.type){case "single":return{background:b.color};case "linear":return{background:n.css+"linear-gradient("+a+"deg,"+b.color.join(",")+")"};case "radial":return{background:n.css+"radial-gradient("+a+"deg,"+b.color.join(",")+")"}}}).on("refresh",function(a){a=b.angle;var c=360-a;switch(b.type){case "single":f.css("background",b.color);break;case "linear":var d=b.color.join(",");f.css("background",n.css+"linear-gradient("+c+"deg,"+d+")");k.css("background",n.css+"linear-gradient(0deg,"+d+")");k.css(n.css+"transform","rotate("+a+"deg)");break;case "radial":f.css("background",n.css+"radial-gradient("+c+"deg,"+b.color.join(",")+")")}a=b.$t.triggerHandler("get",["css"]);b.lastbg!==a.background&&(b.lastbg=a.background,b.$t.trigger("change",[b.$t.triggerHandler("get"),a]))});e.fn.radass=function(a){a=e.extend({type:"linear",angle:90,color:["rgba(255, 0, 255, 1) 0%","rgba(0, 255, 0, 0.7) 30%","rgba(255,255,255,1) 100%"],radius:32,pointPad:4},a);return this.each(function(){var c=e(this);c.on("click",function(a){}).on("load",function(){b=a;b.pos=c.offset();b.$t=c;k.trigger("set",[b.color]);r.trigger("set",[b.angle]).show();q.detach().hide().appendTo(c.parent().css({textAlign:"center"})).show().offset(b.pos)}).on("set",function(a,d){b.angle=d.angle;b.color=d.color;c.trigger("load").trigger("refresh")}).on("get",function(a,c){return"css"===c?f.triggerHandler("css"):{color:b.color,angle:b.angle,type:b.type}}).on("refresh",function(){f.trigger("refresh")}).on("gradhide",function(){q.detach()}).on("gradshow",function(){var a=c.parent();q.hide().appendTo(a).show()}).trigger("load").trigger("refresh")})};e(document).mouseup(function(a){!0!==v||d.is(a.target)||k.is(a.target)||(d.hide(200),v=!1,a.preventDefault());!1===u||x.is(a.target)||0!==x.has(a.target).length||(x.hide(),u.css(F),u=!1,a.preventDefault())})})(jQuery);