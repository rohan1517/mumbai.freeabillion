/*
 jquery.event.drag - v 2.2.1
 Copyright (c) 2010 Three Dub Media - http://threedubmedia.com
 Open Source MIT License - http://threedubmedia.com/code/license
*/
(function(f){f.fn.drag=function(b,a,c){var e="string"==typeof b?b:"",d=f.isFunction(b)?b:f.isFunction(a)?a:null;0!==e.indexOf("drag")&&(e="drag"+e);c=(b==d?a:c)||{};return d?this.bind(e,c,d):this.trigger(e)};var g=f.event,h=g.special,c=h.drag={defaults:{which:1,distance:0,not:":input",handle:null,relative:!1,drop:!0,click:!1},datakey:"dragdata",noBubble:!0,add:function(b){var a=f.data(this,c.datakey),d=b.data||{};a.related+=1;f.each(c.defaults,function(b,c){void 0!==d[b]&&(a[b]=d[b])})},remove:function(){--f.data(this,c.datakey).related},setup:function(){if(!f.data(this,c.datakey)){var b=f.extend({related:0},c.defaults);f.data(this,c.datakey,b);g.add(this,"touchstart mousedown MSPointerDown",c.init,b);this.attachEvent&&this.attachEvent("ondragstart",c.dontstart)}},teardown:function(){(f.data(this,c.datakey)||{}).related||(f.removeData(this,c.datakey),g.remove(this,"touchstart mousedown MSPointerDown",c.init),c.textselect(!0),this.detachEvent&&this.detachEvent("ondragstart",c.dontstart))},init:function(b){if(!c.touched){var a=b.data,d;if(!(0!=b.which&&0<a.which&&b.which!=a.which||f(b.target).is(a.not)||a.handle&&!f(b.target).closest(a.handle,b.currentTarget).length)&&(c.touched="touchstart"==b.type||"MSPointerDown"==b.type?this:null,c.touchedMSPointer="MSPointerDown"==b.type,a.propagates=1,a.mousedown=this,a.interactions=[c.interaction(this,a)],a.target=b.target,a.pageX=b.pageX,a.pageY=b.pageY,a.dragging=null,d=c.hijack(b,"draginit",a),a.propagates&&((d=c.flatten(d))&&d.length&&(a.interactions=[],f.each(d,function(){a.interactions.push(c.interaction(this,a))})),a.propagates=a.interactions.length,!1!==a.drop&&h.drop&&h.drop.handler(b,a),c.textselect(!1),c.touchedMSPointer?g.add(document,"MSPointerMove MSPointerUp MSPointerCancel",c.handler,a):c.touched?g.add(c.touched,"touchmove touchend",c.handler,a):g.add(document,"mousemove mouseup",c.handler,a),!c.touched||a.live)))return!1}},interaction:function(b,a){var d=f(b)[a.relative?"position":"offset"]()||{top:0,left:0};return{drag:b,callback:new c.callback,droppable:[],offset:d}},handler:function(b){var a=b.data;switch(b.type){case !a.dragging&&"touchmove":case !a.dragging&&"MSPointerMove":b.preventDefault();case !a.dragging&&"mousemove":if(Math.pow(b.pageX-a.pageX,2)+Math.pow(b.pageY-a.pageY,2)<Math.pow(a.distance,2))break;b.target=a.target;c.hijack(b,"dragstart",a);a.propagates&&(a.dragging=!0);case "MSPointerMove":case "touchmove":b.preventDefault();case "mousemove":if(a.dragging){c.hijack(b,"drag",a);if(a.propagates){!1!==a.drop&&h.drop&&h.drop.handler(b,a);break}b.type="mouseup"}default:c.touchedMSPointer?g.remove(document,"MSPointerMove MSPointerUp MSPointerCancel",c.handler):c.touched&&!c.touchedMSPointer?g.remove(c.touched,"touchmove touchend",c.handler):g.remove(document,"mousemove mouseup",c.handler),a.dragging&&(!1!==a.drop&&h.drop&&h.drop.handler(b,a),c.hijack(b,"dragend",a)),c.textselect(!0),!1===a.click&&a.dragging&&f.data(a.mousedown,"suppress.click",(new Date).getTime()+5),a.dragging=c.touched=c.touchedMSPointer=!1}},hijack:function(b,a,d,e,h){if(d){var r=b.originalEvent,q=b.type,n=a.indexOf("drop")?"drag":"drop",l,p=e||0,k,m;e=isNaN(e)?d.interactions.length:e;b.type=a;b.originalEvent=null;d.results=[];do!(k=d.interactions[p])||"dragend"!==a&&k.cancelled||(m=c.properties(b,d,k),k.results=[],f(h||k[n]||d.droppable).each(function(e,h){m.target=h;b.isPropagationStopped=function(){return!1};l=h?g.dispatch.call(h,b,m):null;!1===l?("drag"==n&&(k.cancelled=!0,--d.propagates),"drop"==a&&(k[n][e]=null)):"dropinit"==a&&k.droppable.push(c.element(l)||h);"dragstart"==a&&(k.proxy=f(c.element(l)||k.drag)[0]);k.results.push(l);delete b.result;if("dropinit"!==a)return l}),d.results[p]=c.flatten(k.results),"dropinit"==a&&(k.droppable=c.flatten(k.droppable)),"dragstart"!=a||k.cancelled||m.update());while(++p<e);b.type=q;b.originalEvent=r;return c.flatten(d.results)}},properties:function(b,a,d){var e=d.callback;e.drag=d.drag;e.proxy=d.proxy||d.drag;e.startX=a.pageX;e.startY=a.pageY;e.deltaX=b.pageX-a.pageX;e.deltaY=b.pageY-a.pageY;e.originalX=d.offset.left;e.originalY=d.offset.top;e.offsetX=e.originalX+e.deltaX;e.offsetY=e.originalY+e.deltaY;e.drop=c.flatten((d.drop||[]).slice());e.available=c.flatten((d.droppable||[]).slice());return e},element:function(b){if(b&&(b.jquery||1==b.nodeType))return b},flatten:function(b){return f.map(b,function(a){return a&&a.jquery?f.makeArray(a):a&&a.length?c.flatten(a):a})},textselect:function(b){f(document)[b?"unbind":"bind"]("selectstart",c.dontstart).css("MozUserSelect",b?"":"none");document.unselectable=b?"off":"on"},dontstart:function(){return!1},callback:function(){}};c.callback.prototype={update:function(){h.drop&&this.available.length&&f.each(this.available,function(b){h.drop.locate(this,b)})}};var q=g.dispatch;g.dispatch=function(b){if(b&&b.type&&0<f.data(this,"suppress."+b.type)-(new Date).getTime())f.removeData(this,"suppress."+b.type);else return q.apply(this,arguments)};var t=g.fixHooks.MSPointerMove=g.fixHooks.MSPointerUp=g.fixHooks.MSPointerDown={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(b,a){a&&f.each(t.props,function(c,e){b[e]=a[e]});return b}},u=g.fixHooks.touchstart=g.fixHooks.touchmove=g.fixHooks.touchend=g.fixHooks.touchcancel={props:"clientX clientY pageX pageY screenX screenY".split(" "),filter:function(b,a){if(a){var c=a.touches&&a.touches[0]||a.changedTouches&&a.changedTouches[0]||null;c&&f.each(u.props,function(a,d){b[d]=c[d]})}return b}};h.draginit=h.dragstart=h.dragend=c})(jQuery);